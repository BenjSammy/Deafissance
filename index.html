<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Base de connaissances - Deafissance</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPkG6Cw+p1GSo8H4jqwU1V0t8mq1jhtnY7B8MO5NL5Fz26P4gFZb2zKg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="topbar__brand">
        <div class="brand-logo">D</div>
        <div class="brand-text">
          <h1>Deafissance</h1>
          <p>Base de connaissances métiers</p>
        </div>
      </div>
      <div class="topbar__actions">
        <button class="button button--ghost" id="adminToggle" title="Mode administration">
          <i class="fa-solid fa-user-gear"></i>
          <span>Admin</span>
        </button>
      </div>
    </header>

    <main class="workspace">
      <section class="panel services-panel">
        <header class="panel__header">
          <div>
            <h2>Services</h2>
            <p class="panel__subtitle">
              Choisissez un service pour accéder à ses catégories et connaissances.
            </p>
          </div>
          <button class="button button--primary" id="addService">
            <i class="fa-solid fa-circle-plus"></i>
            Nouveau service
          </button>
        </header>
        <div class="service-grid" id="serviceGrid"></div>
      </section>

      <div class="workspace__columns">
        <div class="column column--narrow">
          <section class="panel panel--list">
            <header class="panel__header">
              <h2>Catégories</h2>
              <button class="button button--ghost" id="addCategory">
                <i class="fa-solid fa-folder-plus"></i>
                Ajouter
              </button>
            </header>
            <div class="panel__body">
              <div class="panel__placeholder" id="categoryPlaceholder">
                Sélectionnez un service pour consulter ses catégories.
              </div>
              <ul class="simple-list" id="categoryList"></ul>
            </div>
          </section>

          <section class="panel panel--list">
            <header class="panel__header">
              <h2>Connaissances</h2>
              <button class="button button--ghost" id="addKnowledge">
                <i class="fa-solid fa-circle-plus"></i>
                Ajouter
              </button>
            </header>
            <div class="panel__body">
              <div class="panel__placeholder" id="knowledgePlaceholder">
                Choisissez une catégorie pour afficher ses connaissances.
              </div>
              <ul class="simple-list" id="knowledgeList"></ul>
            </div>
          </section>
        </div>

        <div class="column column--wide">
          <section class="panel editor-panel">
            <div class="panel__body">
              <div class="workspace__empty" id="emptyState">
                <i class="fa-solid fa-lightbulb"></i>
                <p>Sélectionnez ou créez une connaissance pour commencer.</p>
              </div>

              <div class="workspace__content" id="knowledgeEditor" hidden>
                <header class="knowledge-header">
                  <div>
                    <input
                      type="text"
                      id="knowledgeTitle"
                      class="knowledge-header__title"
                      placeholder="Titre de la connaissance"
                    />
                    <div class="knowledge-breadcrumb" id="knowledgeBreadcrumb"></div>
                  </div>
                  <div class="knowledge-actions">
                    <button class="button button--ghost" id="deleteKnowledge">
                      <i class="fa-solid fa-trash"></i>
                      Supprimer
                    </button>
                    <button class="button button--primary" id="saveKnowledge">
                      <i class="fa-solid fa-floppy-disk"></i>
                      Enregistrer
                    </button>
                  </div>
                </header>

                <div class="knowledge-body">
                  <section class="panel panel--sub">
                    <h3>Définition</h3>
                    <textarea
                      id="knowledgeDefinition"
                      placeholder="Décrivez la situation, les prérequis ou les informations importantes..."
                    ></textarea>
                  </section>

                  <section class="panel panel--sub">
                    <header class="panel__header">
                      <div>
                        <h3>Chemin de résolution</h3>
                        <p class="panel__subtitle">
                          Organisez les étapes clés et marquez les issues finales.
                        </p>
                      </div>
                      <button class="button button--ghost" id="addRootStep">
                        <i class="fa-solid fa-circle-plus"></i>
                        Point de départ
                      </button>
                    </header>

                    <div class="progress-card">
                      <div class="progress-card__row">
                        <span class="progress-card__title">Progression des chemins</span>
                        <span class="progress-card__value" id="progressValue">0%</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-bar__fill" id="progressBar"></div>
                      </div>
                      <p class="progress-card__hint">
                        Cochez <strong>Fin de chemin</strong> pour indiquer les réponses finales.
                      </p>
                    </div>

                    <ul class="tree" id="stepTree"></ul>

                    <div class="panel__footer" id="incompletePaths" hidden>
                      <h4>Chemins à compléter</h4>
                      <ul></ul>
                    </div>
                  </section>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <template id="treeNodeTemplate">
      <li class="tree-node" data-id="">
        <div class="tree-node__content">
          <button class="tree-node__toggle" title="Replier / Déplier">
            <i class="fa-solid fa-angle-down"></i>
          </button>
          <div class="tree-node__text" contenteditable="false"></div>
          <div class="tree-node__actions">
            <label class="checkbox">
              <input type="checkbox" class="tree-node__final" />
              <span>Fin de chemin</span>
            </label>
            <button class="icon-button" data-action="add" title="Ajouter un embranchement">
              <i class="fa-solid fa-plus"></i>
            </button>
            <button class="icon-button" data-action="delete" title="Supprimer">
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
        </div>
        <ul class="tree-node__children"></ul>
      </li>
    </template>

    <div class="toast" id="toast" hidden>
      <i class="fa-solid fa-circle-check"></i>
      <span></span>
    </div>

    <script src="app.js"></script>
  </body>
</html>

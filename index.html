<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Base de connaissances - Deafissance</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPkG6Cw+p1GSo8H4jqwU1V0t8mq1jhtnY7B8MO5NL5Fz26P4gFZb2zKg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="topbar__brand">
        <div class="brand-logo">D</div>
        <div class="brand-text">
          <h1>Deafissance</h1>
          <p>Base de connaissances métiers</p>
        </div>
      </div>
      <div class="topbar__actions">
        <button class="button button--ghost" id="adminToggle" title="Mode administration">
          <i class="fa-solid fa-user-gear"></i>
          <span>Admin</span>
        </button>
      </div>
    </header>

    <main class="workspace">
      <section class="panel services-panel">
        <header class="panel__header">
          <div>
            <h2>Services</h2>
            <p class="panel__subtitle">
              Sélectionnez un service pour accéder aux fiches connaissances associées.
            </p>
          </div>
          <button class="button button--primary" id="addService">
            <i class="fa-solid fa-circle-plus"></i>
            Nouveau service
          </button>
        </header>
        <div class="service-grid" id="serviceGrid"></div>
      </section>

      <div class="workspace__columns">
        <div class="column column--narrow">
          <section class="panel panel--list">
            <header class="panel__header">
              <div>
                <h2>Connaissances</h2>
                <p class="panel__subtitle">
                  Parcourez les fiches disponibles pour le service sélectionné.
                </p>
              </div>
            </header>
            <div class="panel__body">
              <div class="panel__placeholder" id="knowledgePlaceholder">
                Choisissez un service pour afficher ses connaissances.
              </div>
              <ul class="simple-list" id="knowledgeList"></ul>
            </div>
          </section>
        </div>

        <div class="column column--wide">
          <section class="panel viewer-panel">
            <div class="workspace__empty" id="emptyState">
              <i class="fa-solid fa-lightbulb"></i>
              <p>Sélectionnez une connaissance pour afficher son parcours.</p>
            </div>

            <div class="workspace__content knowledge-viewer" id="knowledgeViewer" hidden>
              <header class="knowledge-header">
                <div>
                  <h2 class="knowledge-header__title" id="viewerKnowledgeTitle"></h2>
                  <div class="knowledge-breadcrumb" id="viewerBreadcrumb"></div>
                </div>
                <div class="knowledge-actions">
                  <button class="button button--ghost" id="viewerBack">
                    <i class="fa-solid fa-arrow-left"></i>
                    Étape précédente
                  </button>
                  <button class="button button--primary" id="viewerReset">
                    <i class="fa-solid fa-arrows-rotate"></i>
                    Recommencer
                  </button>
                </div>
              </header>

              <div class="knowledge-viewer__body">
                <section class="panel panel--sub knowledge-viewer__definition">
                  <h3>Définition</h3>
                  <p id="viewerDefinition"></p>
                </section>

                <section class="panel panel--sub knowledge-viewer__path">
                  <header class="panel__header">
                    <div>
                      <h3>Chemin actuel</h3>
                      <p class="panel__subtitle" id="viewerStepTitle"></p>
                    </div>
                  </header>
                  <div class="knowledge-viewer__status" id="viewerStatus"></div>
                  <div class="knowledge-viewer__options" id="viewerOptions"></div>
                </section>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <div class="admin-overlay" id="adminOverlay" hidden>
      <div class="admin-overlay__backdrop" id="adminBackdrop"></div>
      <div class="admin-overlay__panel">
        <header class="admin-overlay__header">
          <div>
            <h2>Administration</h2>
            <p>Gérez les services et organisez les connaissances.</p>
          </div>
          <button class="button button--ghost" id="closeAdmin">
            <i class="fa-solid fa-xmark"></i>
            Fermer
          </button>
        </header>
        <div class="admin-overlay__body">
          <aside class="admin-sidebar">
            <section class="admin-section">
              <header class="panel__header">
                <h3>Services</h3>
                <button class="button button--ghost" id="adminAddService">
                  <i class="fa-solid fa-circle-plus"></i>
                  Nouveau
                </button>
              </header>
              <ul class="admin-service-list" id="adminServiceList"></ul>
            </section>

            <section class="admin-section">
              <header class="panel__header">
                <h3>Connaissances</h3>
                <button class="button button--ghost" id="adminAddKnowledge" disabled>
                  <i class="fa-solid fa-circle-plus"></i>
                  Ajouter
                </button>
              </header>
              <div class="panel__placeholder" id="adminKnowledgePlaceholder">
                Sélectionnez un service pour gérer ses connaissances.
              </div>
              <ul class="admin-knowledge-list" id="adminKnowledgeList"></ul>
            </section>
          </aside>

          <div class="admin-editor">
            <div class="workspace__empty" id="adminEmptyState">
              <i class="fa-solid fa-pen-to-square"></i>
              <p>Sélectionnez une connaissance pour la modifier.</p>
            </div>

            <div class="workspace__content editor-panel" id="knowledgeEditor" hidden>
              <header class="knowledge-header">
                <div>
                  <input
                    type="text"
                    id="knowledgeTitle"
                    class="knowledge-header__title"
                    placeholder="Titre de la connaissance"
                  />
                  <div class="knowledge-breadcrumb" id="knowledgeBreadcrumb"></div>
                </div>
                <div class="knowledge-actions">
                  <button class="button button--ghost" id="deleteKnowledge">
                    <i class="fa-solid fa-trash"></i>
                    Supprimer
                  </button>
                  <button class="button button--primary" id="saveKnowledge">
                    <i class="fa-solid fa-floppy-disk"></i>
                    Enregistrer
                  </button>
                </div>
              </header>

              <div class="knowledge-body">
                <section class="panel panel--sub">
                  <h3>Définition</h3>
                  <textarea
                    id="knowledgeDefinition"
                    placeholder="Décrivez la situation, les prérequis ou les informations importantes..."
                  ></textarea>
                </section>

                <section class="panel panel--sub">
                  <header class="panel__header">
                    <div>
                      <h3>Chemin de résolution</h3>
                      <p class="panel__subtitle">
                        Organisez les étapes clés et marquez les issues finales.
                      </p>
                    </div>
                    <button class="button button--ghost" id="addRootStep">
                      <i class="fa-solid fa-circle-plus"></i>
                      Point de départ
                    </button>
                  </header>

                  <div class="progress-card">
                    <div class="progress-card__row">
                      <span class="progress-card__title">Progression des chemins</span>
                      <span class="progress-card__value" id="progressValue">0%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-bar__fill" id="progressBar"></div>
                    </div>
                    <p class="progress-card__hint">
                      Cochez <strong>Fin de chemin</strong> pour indiquer les réponses finales.
                    </p>
                  </div>

                  <ul class="tree" id="stepTree"></ul>

                  <div class="panel__footer" id="incompletePaths" hidden>
                    <h4>Chemins à compléter</h4>
                    <ul></ul>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <template id="treeNodeTemplate">
      <li class="tree-node" data-id="">
        <div class="tree-node__content">
          <button class="tree-node__toggle" title="Replier / Déplier">
            <i class="fa-solid fa-angle-down"></i>
          </button>
          <div class="tree-node__text" contenteditable="false"></div>
          <div class="tree-node__actions">
            <label class="checkbox">
              <input type="checkbox" class="tree-node__final" />
              <span>Fin de chemin</span>
            </label>
            <button class="icon-button" data-action="add" title="Ajouter un embranchement">
              <i class="fa-solid fa-plus"></i>
            </button>
            <button class="icon-button" data-action="delete" title="Supprimer">
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
        </div>
        <ul class="tree-node__children"></ul>
      </li>
    </template>

    <div class="toast" id="toast" hidden>
      <i class="fa-solid fa-circle-check"></i>
      <span></span>
    </div>

    <script src="app.js"></script>
  </body>
</html>
